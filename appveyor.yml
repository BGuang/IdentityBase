version: 1.0.{build}
skip_tags: true
image: Visual Studio 2017
configuration: Release
platform: Any CPU

services:
  - mssql2014
  - postgresql

branches:
  only:
    - master
    - release
    - /^(.*\/)?ci-.*$/

install:
  - bash init.sh

build_script:
  - bash build.sh
  - bash pack.sh

test_script:
  - bash coveralls.sh

artifacts:
  - path: artifacts/packages/*.nupkg

deploy:
  - provider: NuGet
    api_key:
    secure: zvmFPbRUqY3XRSzcu3pTNsOiLshSTF/BylhxFHPhq6H2e1TEDNPeQS2rhnttASCU
    skip_symbols: true
    on:
      branch: master